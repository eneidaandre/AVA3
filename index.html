<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AVA</title>

    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 24px;
      }
      .card {
        max-width: 820px;
        padding: 18px;
        border: 1px solid #ddd;
        border-radius: 12px;
      }
      .row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 10px;
      }
      a.btn {
        display: inline-block;
        padding: 10px 12px;
        border: 1px solid #ddd;
        border-radius: 10px;
        text-decoration: none;
        color: #111;
        background: #fafafa;
      }
      a.btn:hover {
        background: #f2f2f2;
      }
      code {
        background: #f3f3f3;
        padding: 2px 6px;
        border-radius: 6px;
      }
      small {
        color: #555;
      }
      .ok {
        color: #0a7a2f;
        font-weight: 600;
      }
      .err {
        color: #b00020;
        font-weight: 600;
      }
      pre {
        margin-top: 10px;
        background: #f7f7f7;
        border: 1px solid #e6e6e6;
        border-radius: 10px;
        padding: 12px;
        overflow: auto;
        white-space: pre-wrap;
      }
    </style>
  </head>

  <body>
    <div class="card">
      <h1>AVA rodando ✅</h1>

      <p>Teste de conexão com o Supabase:</p>
      <div id="status">Carregando...</div>

      <div class="row">
        <!-- IMPORTANTE: em Project Pages o link precisa ter /AVA3/ na URL,
             mas aqui usamos caminho relativo (./) que funciona corretamente -->
        <a class="btn" href="./login.html">Ir para Login</a>
        <a class="btn" href="./app.html">Ir para App</a>
      </div>

      <pre id="logs" style="display: none"></pre>

      <hr />
      <small>Se der erro, ele aparece aqui e também no Console (F12).</small>
    </div>

    <!-- IMPORTANTE: precisa ser type="module" -->
    <script type="module">
      import { supabaseHealthCheck } from './assets/js/supabaseClient.js';

      const statusEl = document.getElementById('status');
      const logsEl = document.getElementById('logs');

      function log(msg) {
        logsEl.style.display = 'block';
        logsEl.textContent += msg + '\n';
      }

      async function main() {
        try {
          log('[BOOT] Iniciando health check do Supabase...');

          const r = await supabaseHealthCheck();

          if (!r.ok) {
            statusEl.innerHTML = `❌ <span class="err">Erro no Supabase:</span> <code>${r.error}</code>`;
            log('[ERR] ' + r.error);
            return;
          }

          statusEl.innerHTML = `✅ <span class="ok">Conectado ao Supabase!</span> ${
            r.hasSession
              ? '<small>(sessão encontrada)</small>'
              : '<small>(sem sessão — normal)</small>'
          }`;

          log('[OK] Conectado. hasSession=' + String(r.hasSession));
        } catch (e) {
          console.error(e);
          const msg = e?.message || String(e);
          statusEl.innerHTML = `❌ <span class="err">Erro inesperado:</span> <code>${msg}</code>`;
          log('[ERR] ' + msg);
        }
      }

      main();
    </script>
  </body>
</html>
